# main.py
import sqlite3
from pathlib import Path
import re
import customtkinter as ctk
from tkinter import messagebox, ttk
from datetime import datetime
import random

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ setup_db
from bd import initialize_database, get_db_connection


EMAIL_REGEX = re.compile(r"^[^@]+@[^@]+\.[^@]+$")
DB_PATH = Path(__file__).parent / 'online_school.db'

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã customtkinter
ctk.set_appearance_mode("light")
ctk.set_default_color_theme("blue")

# –Ø—Ä–∫–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞
COLORS = {
    'primary': '#B494F8',  # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
    'secondary': '#DBFA40',  # –Ø—Ä–∫–∏–π –∂–µ–ª—Ç—ã–π
    'accent': '#8A6DF0',  # –¢–µ–º–Ω—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
    'background': '#F8F7FF',  # –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω
    'surface': '#FFFFFF',  # –ë–µ–ª—ã–π
    'text_primary': '#2D3748',  # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
    'text_secondary': '#718096',  # –í—Ç–æ—Ä–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç
    'success': '#48BB78',  # –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    'warning': '#ED8936',  # –û—Ä–∞–Ω–∂–µ–≤—ã–π
}


# ========== –§–£–ù–ö–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• ==========
def get_conn():
    """–ê–ª–∏–∞—Å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º"""
    return get_db_connection()


def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    try:
        initialize_database()
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")


def create_user(first_name: str, last_name: str, email: str, password: str, role: str, bio: str) -> None:
    if len(first_name.strip()) < 2:
        raise ValueError("–ò–º—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 2 —Å–∏–º–≤–æ–ª–æ–≤.")
    if len(password) < 6:
        raise ValueError("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤.")
    if not EMAIL_REGEX.match(email.strip()):
        raise ValueError("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email-–∞–¥—Ä–µ—Å.")

    role_map = {'–°—Ç—É–¥–µ–Ω—Ç': 1, '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å': 2, '–ê–¥–º–∏–Ω': 3}
    role_id = role_map.get(role, 1)

    with get_conn() as conn:
        conn.execute(
            "INSERT INTO users (first_name, last_name, email, password, role_id, bio) VALUES (?, ?, ?, ?, ?, ?)",
            (first_name.strip(), last_name.strip(), email.strip(), password, role_id, bio)
        )
        conn.commit()




def find_user_by_email(email: str):
    with get_conn() as conn:
        cur = conn.execute("SELECT * FROM users WHERE email = ?", (email.strip(),))
        return cur.fetchone()


def authenticate_user(email: str, password: str):
    with get_conn() as conn:
        cur = conn.execute(
            "SELECT u.*, r.name as role_name FROM users u JOIN roles r ON u.role_id = r.id WHERE email = ? AND password = ?",
            (email.strip(), password)
        )
        return cur.fetchone()


def get_student_data(student_id):
    """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞"""
    with get_conn() as conn:
        # –ê–∫—Ç–∏–≤–Ω—ã–µ –∫—É—Ä—Å—ã
        cur = conn.execute("SELECT COUNT(*) as count FROM enrollments WHERE student_id = ?", (student_id,))
        active_courses = cur.fetchone()['count']

        # –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã (–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ)
        cur = conn.execute("SELECT COUNT(*) as count FROM enrollments WHERE student_id = ? AND payments = 1",
                           (student_id,))
        completed_courses = cur.fetchone()['count']

        # –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–ª–∞—Ç—ã
        avg_progress = 100 if completed_courses > 0 else 0

        return {
            'active_courses': active_courses,
            'completed_courses': completed_courses,
            'in_progress_courses': active_courses - completed_courses,
            'avg_progress': avg_progress
        }


def get_teacher_data(teacher_id):
    """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                COUNT(DISTINCT c.id) as total_courses,
                COUNT(DISTINCT e.student_id) as total_students
            FROM courses c
            LEFT JOIN enrollments e ON c.id = e.course_id
            WHERE c.teacher_id = ?
        """, (teacher_id,))
        result = cur.fetchone()

        # –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏–∑ –æ—Ç–∑—ã–≤–æ–≤
        cur = conn.execute("""
            SELECT AVG(r.rating) as avg_rating
            FROM reviews r
            WHERE r.id IN (
                SELECT e.reviews_id 
                FROM enrollments e 
                JOIN courses c ON e.course_id = c.id 
                WHERE c.teacher_id = ?
            )
        """, (teacher_id,))
        avg_rating_result = cur.fetchone()

        return {
            'total_courses': result['total_courses'] or 0,
            'total_students': result['total_students'] or 0,
            'avg_rating': round(avg_rating_result['avg_rating'] or 0, 1),
            'completion_rate': 75
        }


def get_admin_data():
    """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–º–∏–Ω-–¥–∞—à–±–æ—Ä–¥–∞"""
    with get_conn() as conn:
        cur = conn.execute("SELECT COUNT(*) as count FROM users")
        total_users = cur.fetchone()['count']

        cur = conn.execute("SELECT COUNT(*) as count FROM courses")
        total_courses = cur.fetchone()['count']

        # –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ enrollments
        cur = conn.execute("""
            SELECT SUM(c.price) as total_revenue
            FROM enrollments e
            JOIN courses c ON e.course_id = c.id
            WHERE e.payments = 1
        """)
        revenue = cur.fetchone()['total_revenue'] or 0

        return {
            'total_users': total_users,
            'total_courses': total_courses,
            'revenue': revenue,
            'active_rate': 85
        }


def get_student_courses(student_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å—ã —Å—Ç—É–¥–µ–Ω—Ç–∞"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                c.id,
                c.title,
                c.description,
                CASE 
                    WHEN e.payments = 1 THEN '–ó–∞–≤–µ—Ä—à–µ–Ω'
                    ELSE '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'
                END as status
            FROM enrollments e
            JOIN courses c ON e.course_id = c.id
            WHERE e.student_id = ?
        """, (student_id,))

        courses = []
        for row in cur.fetchall():
            course = dict(row)
            course['progress'] = 100 if course['status'] == '–ó–∞–≤–µ—Ä—à–µ–Ω' else 0
            courses.append(course)

        return courses


def get_all_courses():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫—É—Ä—Å—ã –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                c.*,
                u.first_name || ' ' || u.last_name as instructor_name,
                CASE c.level
                    WHEN 1 THEN '–ù–∞—á–∏–Ω–∞—é—â–∏–π'
                    WHEN 2 THEN '–°—Ä–µ–¥–Ω–∏–π' 
                    WHEN 3 THEN '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π'
                    ELSE '–ù–µ —É–∫–∞–∑–∞–Ω'
                END as level_name
            FROM courses c
            JOIN users u ON c.teacher_id = u.id
        """)
        return [dict(row) for row in cur.fetchall()]


def get_filtered_courses(level_filter, category_filter):
    """–ü–æ–ª—É—á–∏—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã"""
    with get_conn() as conn:
        query = """
            SELECT DISTINCT
                c.*,
                u.first_name || ' ' || u.last_name as instructor_name,
                CASE c.level
                    WHEN 1 THEN '–ù–∞—á–∏–Ω–∞—é—â–∏–π'
                    WHEN 2 THEN '–°—Ä–µ–¥–Ω–∏–π' 
                    WHEN 3 THEN '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π'
                    ELSE '–ù–µ —É–∫–∞–∑–∞–Ω'
                END as level_name
            FROM courses c
            JOIN users u ON c.teacher_id = u.id
            LEFT JOIN course_categories cc ON c.id = cc.course_id
            LEFT JOIN categories cat ON cc.category_id = cat.id
            WHERE 1=1
        """

        params = []

        # –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é
        if level_filter != "–í—Å–µ —É—Ä–æ–≤–Ω–∏":
            level_map = {"–ù–∞—á–∏–Ω–∞—é—â–∏–π": 1, "–°—Ä–µ–¥–Ω–∏–π": 2, "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π": 3}
            query += " AND c.level = ?"
            params.append(level_map[level_filter])

        # –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        if category_filter != "–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏":
            query += " AND cat.name = ?"
            params.append(category_filter)

        cur = conn.execute(query, params)
        return [dict(row) for row in cur.fetchall()]


def get_users_statistics():
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–¥–º–∏–Ω–∞"""
    with get_conn() as conn:
        cur = conn.execute("SELECT COUNT(*) as count FROM users")
        total = cur.fetchone()['count']

        cur = conn.execute("SELECT COUNT(*) as count FROM users WHERE role_id = 1")
        students = cur.fetchone()['count']

        cur = conn.execute("SELECT COUNT(*) as count FROM users WHERE role_id = 2")
        teachers = cur.fetchone()['count']

        cur = conn.execute("SELECT COUNT(*) as count FROM users WHERE role_id = 3")
        admins = cur.fetchone()['count']

        return {
            'total': total,
            'students': students,
            'teachers': teachers,
            'admins': admins
        }


def get_all_users():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                u.*,
                r.name as role_name,
                COALESCE(datetime(u.created_at), '–ù–µ —É–∫–∞–∑–∞–Ω–∞') as created_at
            FROM users u
            JOIN roles r ON u.role_id = r.id
            ORDER BY u.id DESC
        """)
        users = []
        for row in cur.fetchall():
            user_dict = dict(row)
            # –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ NULL –∑–Ω–∞—á–µ–Ω–∏—è
            for key in user_dict:
                if user_dict[key] is None:
                    if key in ['first_name', 'last_name', 'email', 'bio']:
                        user_dict[key] = ''
                    elif key == 'role_name':
                        user_dict[key] = '–ù–µ —É–∫–∞–∑–∞–Ω–∞'
            users.append(user_dict)
        return users


def get_student_courses_detailed(student_id):
    """–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—É—Ä—Å–∞—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                c.id,
                c.title,
                
                c.description,
                e.payments as is_paid,
                c.duration_hours * 60 as total_minutes,
                e.enrolled_at as enrolled_date
            FROM enrollments e
            JOIN courses c ON e.course_id = c.id
            WHERE e.student_id = ?
        """, (student_id,))

        courses = []
        for row in cur.fetchall():
            course = dict(row)
            if course['is_paid'] == 1:
                course['progress'] = 100
                course['completed_lessons'] = 10
                course['total_lessons'] = 10
            else:
                course['progress'] = 0
                course['completed_lessons'] = 0
                course['total_lessons'] = 10

            course['total_minutes'] = course['total_minutes'] or 0
            courses.append(course)

        return courses


def is_student_enrolled(student_id, course_id):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø–∏—Å–∞–Ω –ª–∏ —Å—Ç—É–¥–µ–Ω—Ç –Ω–∞ –∫—É—Ä—Å"""
    with get_conn() as conn:
        cur = conn.execute("SELECT 1 FROM enrollments WHERE student_id = ? AND course_id = ?", (student_id, course_id))
        return cur.fetchone() is not None


def enroll_student_in_course(student_id, course_id):
    """–ó–∞–ø–∏—Å–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–∞ –∫—É—Ä—Å"""
    try:
        with get_conn() as conn:
            # –°–æ–∑–¥–∞–µ–º –æ—Ç–∑—ã–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            cur = conn.execute("INSERT INTO reviews (rating, comment) VALUES (5, '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ—Ç–∑—ã–≤')")
            review_id = cur.lastrowid

            conn.execute("""
                INSERT INTO enrollments (student_id, course_id, payments, certificates, reviews_id) 
                VALUES (?, ?, 0, '–í –ø—Ä–æ—Ü–µ—Å—Å–µ', ?)
            """, (student_id, course_id, review_id))
            conn.commit()
            return True
    except sqlite3.IntegrityError:
        return False
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å: {e}")
        return False


def unenroll_student_from_course(student_id, course_id):
    """–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–∞ –∫—É—Ä—Å"""
    try:
        with get_conn() as conn:
            # –ù–∞—Ö–æ–¥–∏–º review_id –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
            cur = conn.execute("SELECT reviews_id FROM enrollments WHERE student_id = ? AND course_id = ?",
                               (student_id, course_id))
            result = cur.fetchone()

            if result:
                review_id = result[0]
                # –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –æ –∑–∞—á–∏—Å–ª–µ–Ω–∏–∏
                conn.execute("DELETE FROM enrollments WHERE student_id = ? AND course_id = ?", (student_id, course_id))

                # –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–π –æ—Ç–∑—ã–≤
                conn.execute("DELETE FROM reviews WHERE id = ?", (review_id,))

            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏: {e}")
        return False


def get_teacher_courses(teacher_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                c.*,
                COUNT(DISTINCT e.student_id) as student_count
            FROM courses c
            LEFT JOIN enrollments e ON c.id = e.course_id
            WHERE c.teacher_id = ?
            GROUP BY c.id
        """, (teacher_id,))

        courses = []
        for row in cur.fetchall():
            course = dict(row)

            # –ü–æ–ª—É—á–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –∫—É—Ä—Å–∞
            cur_rating = conn.execute(
                "SELECT AVG(r.rating) as avg_rating FROM reviews r WHERE r.id IN (SELECT e.reviews_id FROM enrollments e WHERE e.course_id = ?)",
                (course['id'],))
            rating_result = cur_rating.fetchone()

            course['avg_rating'] = round(rating_result['avg_rating'], 1) if rating_result['avg_rating'] else None
            course['level_name'] = ['–ù–∞—á–∏–Ω–∞—é—â–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π'][course['level'] - 1] if course['level'] in [
                1, 2, 3] else '–ù–µ —É–∫–∞–∑–∞–Ω'
            courses.append(course)

        return courses


def get_teacher_students(teacher_id):
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT DISTINCT
                u.id as student_id,
                u.first_name,
                u.last_name,
                u.email,
                c.title as course_title,
                e.payments as is_paid
            FROM users u
            JOIN enrollments e ON u.id = e.student_id
            JOIN courses c ON e.course_id = c.id
            WHERE c.teacher_id = ?
        """, (teacher_id,))

        students = []
        for row in cur.fetchall():
            student = dict(row)
            student['progress'] = 100 if student['is_paid'] == 1 else 0
            students.append(student)

        return students


def get_all_courses_admin():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫—É—Ä—Å—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                c.*,
                u.first_name || ' ' || u.last_name as instructor_name,
                COUNT(DISTINCT e.student_id) as student_count
            FROM courses c
            JOIN users u ON c.teacher_id = u.id
            LEFT JOIN enrollments e ON c.id = e.course_id
            GROUP BY c.id
        """)

        courses = []
        for row in cur.fetchall():
            course = dict(row)

            # –ü–æ–ª—É—á–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –∫—É—Ä—Å–∞
            cur_rating = conn.execute(
                "SELECT AVG(r.rating) as avg_rating FROM reviews r WHERE r.id IN (SELECT e.reviews_id FROM enrollments e WHERE e.course_id = ?)",
                (course['id'],))
            rating_result = cur_rating.fetchone()

            course['avg_rating'] = round(rating_result['avg_rating'], 1) if rating_result['avg_rating'] else None
            course['level_name'] = ['–ù–∞—á–∏–Ω–∞—é—â–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π'][course['level'] - 1] if course['level'] in [
                1, 2, 3] else '–ù–µ —É–∫–∞–∑–∞–Ω'
            courses.append(course)

        return courses


def get_all_payments():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö –∏ –∫—É—Ä—Å–∞—Ö"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                e.id as id,
                u.first_name || ' ' || u.last_name as student_name,
                c.title as course_title,
                c.price as amount,
                CASE e.payments 
                    WHEN 1 THEN 'completed'
                    ELSE 'pending'
                END as status,
                'credit_card' as payment_method,
                e.enrolled_at as created_at
            FROM enrollments e
            JOIN users u ON e.student_id = u.id
            JOIN courses c ON e.course_id = c.id
            ORDER BY e.enrolled_at DESC
        """)
        return [dict(row) for row in cur.fetchall()]


def get_finance_statistics():
    """–ü–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                SUM(c.price) as total_revenue,
                COUNT(CASE WHEN e.payments = 1 THEN 1 END) as completed_payments,
                COUNT(CASE WHEN e.payments = 0 THEN 1 END) as pending_payments,
                AVG(CASE WHEN e.payments = 1 THEN c.price END) as avg_payment
            FROM enrollments e
            JOIN courses c ON e.course_id = c.id
        """)
        result = cur.fetchone()

        return {
            'total_revenue': result['total_revenue'] or 0,
            'completed_payments': result['completed_payments'] or 0,
            'pending_payments': result['pending_payments'] or 0,
            'avg_payment': round(result['avg_payment'] or 0, 2)
        }

def get_teachers():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π"""
    with get_conn() as conn:
        cur = conn.execute("SELECT id, first_name, last_name FROM users WHERE role_id = 2")
        return [dict(row) for row in cur.fetchall()]


def add_course(title, description, price, level, duration_hours, teacher_id):
    """–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
    try:
        with get_conn() as conn:
            conn.execute(
                "INSERT INTO courses (title, description, price, level, duration_hours, teacher_id) VALUES (?, ?, ?, ?, ?, ?)",
                (title, description, price, level, duration_hours, teacher_id))
            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–∞: {e}")
        return False


def update_course(course_id, title, description, price, level, duration_hours, teacher_id):
    """–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–∞"""
    try:
        with get_conn() as conn:
            conn.execute(
                "UPDATE courses SET title = ?, description = ?, price = ?, level = ?, duration_hours = ?, teacher_id = ? WHERE id = ?",
                (title, description, price, level, duration_hours, teacher_id, course_id))
            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–∞: {e}")
        return False


def get_course_by_id(course_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å –ø–æ ID"""
    with get_conn() as conn:
        cur = conn.execute(
            "SELECT c.*, u.first_name || ' ' || u.last_name as instructor_name FROM courses c JOIN users u ON c.teacher_id = u.id WHERE c.id = ?",
            (course_id,))
        result = cur.fetchone()
        return dict(result) if result else None


def get_categories():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    with get_conn() as conn:
        cur = conn.execute("SELECT * FROM categories")
        return [dict(row) for row in cur.fetchall()]


def get_course_categories(course_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫—É—Ä—Å–∞"""
    with get_conn() as conn:
        cur = conn.execute(
            "SELECT c.id, c.name FROM categories c JOIN course_categories cc ON c.id = cc.category_id WHERE cc.course_id = ?",
            (course_id,))
        return [dict(row) for row in cur.fetchall()]


def add_course_category(course_id, category_id):
    """–î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å –∫—É—Ä—Å-–∫–∞—Ç–µ–≥–æ—Ä–∏—è"""
    try:
        with get_conn() as conn:
            conn.execute("INSERT INTO course_categories (course_id, category_id) VALUES (?, ?)",
                         (course_id, category_id))
            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫—É—Ä—Å–∞: {e}")
        return False


def update_course_categories(course_id, category_ids):
    """–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫—É—Ä—Å–∞"""
    try:
        with get_conn() as conn:
            # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            conn.execute("DELETE FROM course_categories WHERE course_id = ?", (course_id,))

            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            for category_id in category_ids:
                conn.execute("INSERT INTO course_categories (course_id, category_id) VALUES (?, ?)",
                             (course_id, category_id))

            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫—É—Ä—Å–∞: {e}")
        return False


def get_last_course_id():
    """–ü–æ–ª—É—á–∏—Ç—å ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞"""
    with get_conn() as conn:
        cur = conn.execute("SELECT id FROM courses ORDER BY id DESC LIMIT 1")
        result = cur.fetchone()
        return result['id'] if result else None


def get_all_enrollments():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å—ã"""
    with get_conn() as conn:
        cur = conn.execute("""
            SELECT 
                e.id as enrollment_id,
                u.first_name || ' ' || u.last_name as student_name,
                u.email as student_email,
                c.title as course_title,
                u2.first_name || ' ' || u2.last_name as instructor_name,
                datetime(e.enrolled_at) as enrolled_date,
                e.payments as is_paid
            FROM enrollments e
            JOIN users u ON e.student_id = u.id
            JOIN courses c ON e.course_id = c.id
            JOIN users u2 ON c.teacher_id = u2.id
            ORDER BY e.enrolled_at DESC
        """)

        enrollments = []
        for row in cur.fetchall():
            enrollment = dict(row)
            enrollment['progress'] = 100 if enrollment['is_paid'] == 1 else 0
            enrollments.append(enrollment)

        return enrollments


def delete_enrollment(enrollment_id):
    """–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å"""
    try:
        with get_conn() as conn:
            # –ù–∞—Ö–æ–¥–∏–º review_id –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
            cur = conn.execute("SELECT reviews_id FROM enrollments WHERE id = ?", (enrollment_id,))
            result = cur.fetchone()

            if result:
                review_id = result[0]
                # –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –æ –∑–∞—á–∏—Å–ª–µ–Ω–∏–∏
                conn.execute("DELETE FROM enrollments WHERE id = ?", (enrollment_id,))
                # –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–π –æ—Ç–∑—ã–≤
                conn.execute("DELETE FROM reviews WHERE id = ?", (review_id,))

            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏: {e}")
        return False


def delete_course(course_id):
    """–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    try:
        with get_conn() as conn:
            conn.execute("PRAGMA foreign_keys = ON")
            conn.execute("DELETE FROM courses WHERE id = ?", (course_id,))
            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–∞: {e}")
        return False


def get_user_by_id(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID"""
    with get_conn() as conn:
        cur = conn.execute(
            "SELECT u.*, r.name as role_name, datetime(u.created_at) as created_at FROM users u JOIN roles r ON u.role_id = r.id WHERE u.id = ?",
            (user_id,))
        result = cur.fetchone()
        return dict(result) if result else None


def update_user(user_id, first_name, last_name, email, role, bio):
    """–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    try:
        role_map = {'–°—Ç—É–¥–µ–Ω—Ç': 1, '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å': 2, '–ê–¥–º–∏–Ω': 3}
        role_id = role_map.get(role, 1)

        with get_conn() as conn:
            conn.execute("UPDATE users SET first_name = ?, last_name = ?, email = ?, role_id = ?, bio = ? WHERE id = ?",
                         (first_name, last_name, email, role_id, bio, user_id))
            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {e}")
        return False


def delete_user(user_id):
    """–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    try:
        with get_conn() as conn:
            conn.execute("PRAGMA foreign_keys = ON")
            conn.execute("DELETE FROM users WHERE id = ?", (user_id,))
            conn.commit()
            return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {e}")
        return False


# ========== –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ==========
class EducationalPlatform:
    def __init__(self):
        self.root = ctk.CTk()
        self.current_user = None
        self.setup_window()
        self.show_login_page()

    def setup_window(self):
        self.root.title("EduPlatform Pro")
        self.root.geometry("1200x800")
        self.root.minsize(1000, 700)
        self.root.configure(fg_color=COLORS['background'])

    def clear_window(self):
        for widget in self.root.winfo_children():
            widget.destroy()

    def show_login_page(self):
        self.clear_window()

        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
        main_frame = ctk.CTkFrame(self.root, fg_color=COLORS['surface'], corner_radius=20)
        main_frame.pack(expand=True, padx=50, pady=50, fill="both")

        # –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        left_frame = ctk.CTkFrame(main_frame, fg_color=COLORS['primary'], corner_radius=15)
        left_frame.pack(side="left", fill="both", expand=True, padx=(0, 10), pady=20)

        welcome_label = ctk.CTkLabel(left_frame, text="–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤\nEduPlatform Pro",
                                     font=("Segoe UI", 28, "bold"),
                                     text_color="white",
                                     justify="center")
        welcome_label.pack(expand=True, pady=50)

        features = [
            "üéì 100+ –∫—É—Ä—Å–æ–≤",
            "üìä –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å",
            "üë• –°–æ–æ–±—â–µ—Å—Ç–≤–æ",
            "üèÜ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã"
        ]

        for feature in features:
            feature_label = ctk.CTkLabel(left_frame, text=feature,
                                         font=("Segoe UI", 16),
                                         text_color="white")
            feature_label.pack(pady=8)

        # –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
        right_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        right_frame.pack(side="right", fill="both", expand=True, padx=(10, 0), pady=20)

        title_label = ctk.CTkLabel(right_frame, text="–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(pady=(40, 30))

        # –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
        form_frame = ctk.CTkFrame(right_frame, fg_color="transparent")
        form_frame.pack(fill="x", padx=40, pady=20)

        self.login_email = ctk.CTkEntry(form_frame, placeholder_text="Email",
                                        height=50, font=("Segoe UI", 14),
                                        border_color=COLORS['primary'])
        self.login_email.pack(fill="x", pady=12)

        self.login_password = ctk.CTkEntry(form_frame, placeholder_text="–ü–∞—Ä–æ–ª—å",
                                           height=50, font=("Segoe UI", 14),
                                           show="‚óè", border_color=COLORS['primary'])
        self.login_password.pack(fill="x", pady=12)
        self.login_password.bind('<Return>', lambda e: self.login())

        # –ö–Ω–æ–ø–∫–∏
        button_frame = ctk.CTkFrame(right_frame, fg_color="transparent")
        button_frame.pack(pady=30)

        login_btn = ctk.CTkButton(button_frame, text="–í–æ–π—Ç–∏",
                                  command=self.login, height=50,
                                  fg_color=COLORS['primary'],
                                  hover_color=COLORS['accent'],
                                  font=("Segoe UI", 16, "bold"))
        login_btn.pack(fill="x", pady=8)

        register_btn = ctk.CTkButton(button_frame, text="–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç",
                                     command=self.show_register_page, height=45,
                                     fg_color=COLORS['secondary'],
                                     hover_color="#C8E830",
                                     text_color=COLORS['text_primary'],
                                     font=("Segoe UI", 14, "bold"))
        register_btn.pack(fill="x", pady=8)

    def show_register_page(self):
        self.clear_window()

        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        main_frame = ctk.CTkScrollableFrame(self.root, fg_color=COLORS['surface'], corner_radius=20)
        main_frame.pack(expand=True, padx=50, pady=30, fill="both")

        # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        title_label = ctk.CTkLabel(main_frame, text="–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(pady=(30, 20))

        # –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        form_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        form_frame.pack(fill="x", padx=60, pady=10)

        # –ü–æ–ª—è –≤–≤–æ–¥–∞
        fields = [
            ("–ò–º—è", "reg_first_name"),
            ("–§–∞–º–∏–ª–∏—è", "reg_last_name"),
            ("Email", "reg_email"),
            ("–ü–∞—Ä–æ–ª—å", "reg_password"),
        ]

        for placeholder, attr_name in fields:
            entry = ctk.CTkEntry(form_frame, placeholder_text=placeholder,
                                 height=45, font=("Segoe UI", 14),
                                 border_color=COLORS['primary'])
            if attr_name == "reg_password":
                entry.configure(show="‚óè")
            entry.pack(fill="x", pady=8)
            setattr(self, attr_name, entry)

        # –†–æ–ª—å
        self.reg_role = ctk.CTkComboBox(form_frame, values=["–°—Ç—É–¥–µ–Ω—Ç", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "–ê–¥–º–∏–Ω"],
                                        height=45, font=("Segoe UI", 14),
                                        border_color=COLORS['primary'],
                                        dropdown_font=("Segoe UI", 14),
                                        button_color=COLORS['primary'])
        self.reg_role.set("–°—Ç—É–¥–µ–Ω—Ç")
        self.reg_role.pack(fill="x", pady=8)

        # –û —Å–µ–±–µ
        bio_label = ctk.CTkLabel(form_frame, text="–û —Å–µ–±–µ:",
                                 font=("Segoe UI", 14),
                                 text_color=COLORS['text_primary'])
        bio_label.pack(anchor="w", pady=(10, 5))

        self.reg_bio = ctk.CTkTextbox(form_frame, height=100, font=("Segoe UI", 14),
                                      border_color=COLORS['primary'])
        self.reg_bio.pack(fill="x", pady=8)

        # –ö–Ω–æ–ø–∫–∏
        button_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        button_frame.pack(pady=30)

        register_btn = ctk.CTkButton(button_frame, text="–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç",
                                     command=self.register, height=50,
                                     fg_color=COLORS['primary'],
                                     hover_color=COLORS['accent'],
                                     font=("Segoe UI", 16, "bold"))
        register_btn.pack(fill="x", pady=8)

        back_btn = ctk.CTkButton(button_frame, text="–ù–∞–∑–∞–¥",
                                 command=self.show_login_page, height=45,
                                 fg_color="transparent",
                                 text_color=COLORS['primary'],
                                 border_color=COLORS['primary'],
                                 border_width=2,
                                 font=("Segoe UI", 14))
        back_btn.pack(fill="x", pady=8)

    def show_main_page(self):
        self.clear_window()
        self.create_navigation()
        self.show_dashboard()

    def create_navigation(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–π –ø–∞–Ω–µ–ª–∏"""
        # –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
        nav_frame = ctk.CTkFrame(self.root, height=80, fg_color=COLORS['surface'],
                                 corner_radius=0)
        nav_frame.pack(fill="x", padx=0, pady=0)
        nav_frame.pack_propagate(False)

        # –õ–æ–≥–æ—Ç–∏–ø —Å–ª–µ–≤–∞
        logo_frame = ctk.CTkFrame(nav_frame, fg_color="transparent")
        logo_frame.pack(side="left", padx=30)

        logo_label = ctk.CTkLabel(logo_frame, text="üéì EduPlatform Pro",
                                  font=("Segoe UI", 22, "bold"),
                                  text_color=COLORS['primary'])
        logo_label.pack(side="left")

        # –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É
        nav_buttons_frame = ctk.CTkFrame(nav_frame, fg_color="transparent")
        nav_buttons_frame.pack(side="left", padx=40, expand=True)

        if self.current_user['role'] == '–°—Ç—É–¥–µ–Ω—Ç':
            nav_items = ["–ì–ª–∞–≤–Ω–∞—è", "–ú–æ–∏ –∫—É—Ä—Å—ã", "–ö–∞—Ç–∞–ª–æ–≥"]
        elif self.current_user['role'] == '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å':
            nav_items = ["–ì–ª–∞–≤–Ω–∞—è", "–ú–æ–∏ –∫—É—Ä—Å—ã", "–°—Ç—É–¥–µ–Ω—Ç—ã"]
        else:
            nav_items = ["–ì–ª–∞–≤–Ω–∞—è", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", "–ö—É—Ä—Å—ã", "–ó–∞–ø–∏—Å–∏", "–§–∏–Ω–∞–Ω—Å—ã"]

        for item in nav_items:
            btn = ctk.CTkButton(nav_buttons_frame, text=item,
                                fg_color="transparent",
                                text_color=COLORS['text_primary'],
                                hover_color=COLORS['background'],
                                font=("Segoe UI", 14),
                                width=100,
                                command=lambda i=item: self.navigation_handler(i))
            btn.pack(side="left", padx=5)

        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å–ø—Ä–∞–≤–∞
        user_frame = ctk.CTkFrame(nav_frame, fg_color="transparent")
        user_frame.pack(side="right", padx=20)

        # –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞)
        role_colors = {
            '–°—Ç—É–¥–µ–Ω—Ç': COLORS['primary'],
            '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å': COLORS['success'],
            '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä': COLORS['warning']
        }

        role_label = ctk.CTkLabel(user_frame, text=self.current_user['role'],
                                  font=("Segoe UI", 12, "bold"),
                                  text_color=role_colors.get(self.current_user['role'], COLORS['text_primary']))
        role_label.pack(side="top", anchor="e", pady=(8, 0))

        # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ä–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞)
        user_label = ctk.CTkLabel(user_frame,
                                  text=f"{self.current_user['first_name']} {self.current_user['last_name']}",
                                  font=("Segoe UI", 14),
                                  text_color=COLORS['text_primary'])
        user_label.pack(side="top", anchor="e", pady=(0, 5))

        # –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ (–Ω–∏–∂–Ω—è—è —Å—Ç—Ä–æ–∫–∞)
        logout_btn = ctk.CTkButton(user_frame, text="–í—ã–π—Ç–∏",
                                   command=self.logout, height=30,
                                   fg_color=COLORS['primary'],
                                   hover_color=COLORS['accent'],
                                   font=("Segoe UI", 12),
                                   width=80)
        logout_btn.pack(side="top", anchor="e")

    def navigation_handler(self, page):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏"""
        if page == "–ì–ª–∞–≤–Ω–∞—è":
            self.show_dashboard()
        elif page == "–ú–æ–∏ –∫—É—Ä—Å—ã":
            self.show_my_courses()
        elif page == "–ö–∞—Ç–∞–ª–æ–≥":
            self.show_course_catalog()
        elif page == "–°—Ç—É–¥–µ–Ω—Ç—ã":
            self.show_students()
        elif page == "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏":
            self.show_users()
        elif page == "–ö—É—Ä—Å—ã":
            self.show_courses_admin()
        elif page == "–ó–∞–ø–∏—Å–∏":
            self.show_enrollments_admin()
        elif page == "–§–∏–Ω–∞–Ω—Å—ã":
            self.show_finances()

    def show_dashboard(self):
        """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –¥–∞—à–±–æ—Ä–¥–æ–º"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        welcome_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=15)
        welcome_frame.pack(fill="x", pady=(0, 20))

        welcome_label = ctk.CTkLabel(welcome_frame,
                                     text=f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {self.current_user['first_name']}!",
                                     font=("Segoe UI", 24, "bold"),
                                     text_color=COLORS['primary'])
        welcome_label.pack(anchor="w", pady=20, padx=20)

        # –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        if self.current_user['role'] == '–°—Ç—É–¥–µ–Ω—Ç':
            self.show_student_dashboard(content_frame)
        elif self.current_user['role'] == '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å':
            self.show_teacher_dashboard(content_frame)
        else:  # –ê–¥–º–∏–Ω
            self.show_admin_dashboard(content_frame)

    def show_student_dashboard(self, parent):
        """–î–∞—à–±–æ—Ä–¥ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞"""
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
        student_data = get_student_data(self.current_user['id'])

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É —Å—Ç—É–¥–µ–Ω—Ç–∞ –∫—É—Ä—Å—ã
        if student_data['active_courses'] == 0:
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤
            no_courses_frame = ctk.CTkFrame(parent, fg_color=COLORS['surface'], corner_radius=15)
            no_courses_frame.pack(fill="both", expand=True, pady=20)

            no_courses_label = ctk.CTkLabel(no_courses_frame,
                                            text="üìö –í—ã –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∏ –Ω–∞ –æ–¥–∏–Ω –∫—É—Ä—Å",
                                            font=("Segoe UI", 22, "bold"),
                                            text_color=COLORS['primary'])
            no_courses_label.pack(expand=True, pady=50)

            message_label = ctk.CTkLabel(no_courses_frame,
                                         text="–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è",
                                         font=("Segoe UI", 16),
                                         text_color=COLORS['text_secondary'])
            message_label.pack(pady=10)

            catalog_btn = ctk.CTkButton(no_courses_frame, text="–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥",
                                        command=self.show_course_catalog, height=50,
                                        fg_color=COLORS['primary'],
                                        hover_color=COLORS['accent'],
                                        font=("Segoe UI", 16, "bold"))
            catalog_btn.pack(pady=20)
        else:
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            stats_frame = ctk.CTkFrame(parent, fg_color="transparent")
            stats_frame.pack(fill="x", pady=(0, 20))

            stats_data = [
                ("üìö –ê–∫—Ç–∏–≤–Ω—ã–µ –∫—É—Ä—Å—ã", student_data['active_courses'], COLORS['primary']),
                ("‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ", student_data['completed_courses'], COLORS['success']),
                ("‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ", student_data['in_progress_courses'], COLORS['warning']),
                ("üèÜ –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å", f"{student_data['avg_progress']}%", COLORS['secondary'])
            ]

            for title, value, color in stats_data:
                stat_card = ctk.CTkFrame(stats_frame, fg_color=COLORS['surface'], corner_radius=12)
                stat_card.pack(side="left", fill="both", expand=True, padx=(0, 15))

                value_label = ctk.CTkLabel(stat_card, text=str(value),
                                           font=("Segoe UI", 28, "bold"),
                                           text_color=color)
                value_label.pack(pady=(15, 5))

                title_label = ctk.CTkLabel(stat_card, text=title,
                                           font=("Segoe UI", 12),
                                           text_color=COLORS['text_secondary'])
                title_label.pack(pady=(0, 15))

            # –ú–æ–∏ –∫—É—Ä—Å—ã
            courses_frame = ctk.CTkFrame(parent, fg_color=COLORS['surface'], corner_radius=15)
            courses_frame.pack(fill="both", expand=True)

            courses_label = ctk.CTkLabel(courses_frame, text="üéØ –ú–æ–∏ –∫—É—Ä—Å—ã",
                                         font=("Segoe UI", 20, "bold"),
                                         text_color=COLORS['primary'])
            courses_label.pack(anchor="w", pady=20, padx=20)

            # –¢–∞–±–ª–∏—Ü–∞ –∫—É—Ä—Å–æ–≤
            self.create_courses_table(courses_frame)

    def create_courses_table(self, parent):
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∫—É—Ä—Å–æ–≤"""
        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        headers_frame = ctk.CTkFrame(parent, fg_color=COLORS['primary'], height=50)
        headers_frame.pack(fill="x", padx=20, pady=(0, 10))
        headers_frame.pack_propagate(False)

        headers = ["–ö—É—Ä—Å", "–ü—Ä–æ–≥—Ä–µ—Å—Å", "–°—Ç–∞—Ç—É—Å", "–î–µ–π—Å—Ç–≤–∏—è"]
        widths = [400, 150, 150, 200]

        for i, (header, width) in enumerate(zip(headers, widths)):
            label = ctk.CTkLabel(headers_frame, text=header,
                                 font=("Segoe UI", 14, "bold"),
                                 text_color="white",
                                 width=width - 20)
            label.place(x=sum(widths[:i]) + 10, y=15)

        # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫—É—Ä—Å–æ–≤ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        courses_container = ctk.CTkScrollableFrame(parent, fg_color="transparent")
        courses_container.pack(fill="both", expand=True, padx=20, pady=(0, 20))

        # –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
        student_courses = get_student_courses(self.current_user['id'])

        if not student_courses:
            no_courses_label = ctk.CTkLabel(courses_container, text="–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤",
                                            font=("Segoe UI", 16),
                                            text_color=COLORS['text_secondary'])
            no_courses_label.pack(expand=True, pady=50)
            return

        for course in student_courses:
            course_frame = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'],
                                        corner_radius=10, height=70)
            course_frame.pack(fill="x", pady=5)
            course_frame.pack_propagate(False)

            # –ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞
            title_label = ctk.CTkLabel(course_frame, text=course['title'],
                                       font=("Segoe UI", 14, "bold"),
                                       text_color=COLORS['text_primary'],
                                       width=380)
            title_label.place(x=10, y=10)

            # –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            progress_frame = ctk.CTkFrame(course_frame, fg_color="transparent",
                                          width=130, height=50)
            progress_frame.place(x=400, y=10)

            progress_bar = ctk.CTkProgressBar(progress_frame, height=20)
            progress_bar.pack(fill="x", pady=5)
            progress_bar.set(course['progress'] / 100)

            progress_label = ctk.CTkLabel(progress_frame, text=f"{course['progress']}%",
                                          font=("Segoe UI", 12))
            progress_label.pack()

            # –°—Ç–∞—Ç—É—Å
            status_color = COLORS['success'] if course['progress'] == 100 else COLORS['warning']
            status_label = ctk.CTkLabel(course_frame, text=course['status'],
                                        font=("Segoe UI", 12, "bold"),
                                        text_color=status_color,
                                        width=130)
            status_label.place(x=550, y=25)

            # –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            actions_frame = ctk.CTkFrame(course_frame, fg_color="transparent",
                                         width=180, height=40)
            actions_frame.place(x=700, y=15)

            if course['progress'] < 100:
                continue_btn = ctk.CTkButton(actions_frame, text="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
                                             height=35,
                                             fg_color=COLORS['primary'],
                                             hover_color=COLORS['accent'],
                                             font=("Segoe UI", 12))
                continue_btn.pack(side="left", padx=5)
            else:
                certificate_btn = ctk.CTkButton(actions_frame, text="–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç",
                                                height=35,
                                                fg_color=COLORS['success'],
                                                font=("Segoe UI", 12))
                certificate_btn.pack(side="left", padx=5)

    def show_teacher_dashboard(self, parent):
        """–î–∞—à–±–æ—Ä–¥ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏"""
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        quick_actions_frame = ctk.CTkFrame(parent, fg_color=COLORS['surface'], corner_radius=15)
        quick_actions_frame.pack(fill="x", pady=(0, 20))

        actions_label = ctk.CTkLabel(quick_actions_frame, text="üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø",
                                     font=("Segoe UI", 20, "bold"),
                                     text_color=COLORS['primary'])
        actions_label.pack(anchor="w", pady=20, padx=20)

        actions_buttons_frame = ctk.CTkFrame(quick_actions_frame, fg_color="transparent")
        actions_buttons_frame.pack(fill="x", padx=20, pady=(0, 20))

        actions = [
            ("üìö –ú–æ–∏ –∫—É—Ä—Å—ã", self.show_my_courses),
            ("üë• –ú–æ–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã", self.show_students),
        ]

        for action_text, action_command in actions:
            btn = ctk.CTkButton(actions_buttons_frame, text=action_text,
                                command=action_command, height=50,
                                fg_color=COLORS['primary'],
                                hover_color=COLORS['accent'],
                                font=("Segoe UI", 16, "bold"))
            btn.pack(side="left", padx=10)

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        teacher_data = get_teacher_data(self.current_user['id'])

        stats_frame = ctk.CTkFrame(parent, fg_color="transparent")
        stats_frame.pack(fill="x", pady=(0, 20))

        stats_data = [
            ("üìö –ú–æ–∏ –∫—É—Ä—Å—ã", teacher_data['total_courses'], COLORS['primary']),
            ("üë• –ú–æ–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã", teacher_data['total_students'], COLORS['success']),
            ("‚≠ê –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥", f"{teacher_data['avg_rating']}", COLORS['warning']),
            ("üìà –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è", f"{teacher_data['completion_rate']}%", COLORS['secondary'])
        ]

        for title, value, color in stats_data:
            stat_card = ctk.CTkFrame(stats_frame, fg_color=COLORS['surface'], corner_radius=12)
            stat_card.pack(side="left", fill="both", expand=True, padx=(0, 15))

            value_label = ctk.CTkLabel(stat_card, text=str(value),
                                       font=("Segoe UI", 24, "bold"),
                                       text_color=color)
            value_label.pack(pady=(15, 5))

            title_label = ctk.CTkLabel(stat_card, text=title,
                                       font=("Segoe UI", 12),
                                       text_color=COLORS['text_secondary'])
            title_label.pack(pady=(0, 15))

        # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫—É—Ä—Å—ã
        courses_frame = ctk.CTkFrame(parent, fg_color=COLORS['surface'], corner_radius=15)
        courses_frame.pack(fill="both", expand=True)

        courses_label = ctk.CTkLabel(courses_frame, text="üìñ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫—É—Ä—Å—ã",
                                     font=("Segoe UI", 20, "bold"),
                                     text_color=COLORS['primary'])
        courses_label.pack(anchor="w", pady=20, padx=20)

        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫—É—Ä—Å–æ–≤ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        teacher_courses = get_teacher_courses(self.current_user['id'])[:3]  # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 3 –∫—É—Ä—Å–∞

        if not teacher_courses:
            no_courses_label = ctk.CTkLabel(courses_frame, text="–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤",
                                            font=("Segoe UI", 16),
                                            text_color=COLORS['text_secondary'])
            no_courses_label.pack(expand=True, pady=50)
        else:
            for course in teacher_courses:
                course_card = ctk.CTkFrame(courses_frame, fg_color=COLORS['background'],
                                           corner_radius=10)
                course_card.pack(fill="x", pady=5, padx=20)

                course_header = ctk.CTkFrame(course_card, fg_color="transparent")
                course_header.pack(fill="x", padx=15, pady=10)

                title_label = ctk.CTkLabel(course_header, text=course['title'],
                                           font=("Segoe UI", 16, "bold"),
                                           text_color=COLORS['primary'])
                title_label.pack(side="left")

                students_label = ctk.CTkLabel(course_header, text=f"üë• {course['student_count']} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                              font=("Segoe UI", 14),
                                              text_color=COLORS['text_secondary'])
                students_label.pack(side="right")

    def show_admin_dashboard(self, parent):
        """–î–∞—à–±–æ—Ä–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        stats_frame = ctk.CTkFrame(parent, fg_color="transparent")
        stats_frame.pack(fill="x", pady=(0, 20))

        admin_data = get_admin_data()

        stats_data = [
            ("üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", admin_data['total_users'], COLORS['primary']),
            ("üìö –í—Å–µ –∫—É—Ä—Å—ã", admin_data['total_courses'], COLORS['success']),
            ("üí∞ –î–æ—Ö–æ–¥—ã", f"${admin_data['revenue']}", COLORS['warning']),
            ("üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", f"{admin_data['active_rate']}%", COLORS['secondary'])
        ]

        for title, value, color in stats_data:
            stat_card = ctk.CTkFrame(stats_frame, fg_color=COLORS['surface'], corner_radius=12)
            stat_card.pack(side="left", fill="both", expand=True, padx=(0, 15))

            value_label = ctk.CTkLabel(stat_card, text=str(value),
                                       font=("Segoe UI", 24, "bold"),
                                       text_color=color)
            value_label.pack(pady=(15, 5))

            title_label = ctk.CTkLabel(stat_card, text=title,
                                       font=("Segoe UI", 12),
                                       text_color=COLORS['text_secondary'])
            title_label.pack(pady=(0, 15))

        # –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        actions_frame = ctk.CTkFrame(parent, fg_color=COLORS['surface'], corner_radius=15)
        actions_frame.pack(fill="both", expand=True)

        actions_label = ctk.CTkLabel(actions_frame, text="‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π",
                                     font=("Segoe UI", 20, "bold"),
                                     text_color=COLORS['primary'])
        actions_label.pack(anchor="w", pady=20, padx=20)

        actions_buttons_frame = ctk.CTkFrame(actions_frame, fg_color="transparent")
        actions_buttons_frame.pack(fill="x", padx=20, pady=(0, 20))

        actions = [
            ("üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", self.show_users),
            ("üìö –ö—É—Ä—Å—ã", self.show_courses_admin),
            ("üìã –ó–∞–ø–∏—Å–∏", self.show_enrollments_admin),
            ("üí∞ –§–∏–Ω–∞–Ω—Å—ã", self.show_finances),
            ("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å", self.show_add_course)
        ]

        for action_text, action_command in actions:
            btn = ctk.CTkButton(actions_buttons_frame, text=action_text,
                                command=action_command, height=45,
                                fg_color=COLORS['primary'],
                                hover_color=COLORS['accent'],
                                font=("Segoe UI", 14))
            btn.pack(side="left", padx=10)

    def show_my_courses(self):
        """–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–∏ –∫—É—Ä—Å—ã (–¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π)"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üìö –ú–æ–∏ –∫—É—Ä—Å—ã",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        if self.current_user['role'] == '–°—Ç—É–¥–µ–Ω—Ç':
            self.show_student_courses(content_frame)
        elif self.current_user['role'] == '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å':
            self.show_teacher_courses(content_frame)
        else:
            self.show_all_courses_admin(content_frame)

    def show_student_courses(self, parent):
        """–ö—É—Ä—Å—ã —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏ –ü–†–û–ö–†–£–¢–ö–û–ô"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º CTkScrollableFrame –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        courses_container = ctk.CTkScrollableFrame(parent, fg_color="transparent")
        courses_container.pack(fill="both", expand=True)

        student_courses = get_student_courses_detailed(self.current_user['id'])

        if not student_courses:
            no_courses_frame = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'], corner_radius=15)
            no_courses_frame.pack(fill="both", expand=True, pady=20, padx=20)

            no_courses_label = ctk.CTkLabel(no_courses_frame,
                                            text="üìö –í—ã –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∏ –Ω–∞ –æ–¥–∏–Ω –∫—É—Ä—Å",
                                            font=("Segoe UI", 20, "bold"),
                                            text_color=COLORS['primary'])
            no_courses_label.pack(expand=True, pady=50)

            message_label = ctk.CTkLabel(no_courses_frame,
                                         text="–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è",
                                         font=("Segoe UI", 14),
                                         text_color=COLORS['text_secondary'])
            message_label.pack(pady=10)

            catalog_btn = ctk.CTkButton(no_courses_frame, text="–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥",
                                        command=self.show_course_catalog, height=45,
                                        fg_color=COLORS['primary'],
                                        hover_color=COLORS['accent'],
                                        font=("Segoe UI", 14, "bold"))
            catalog_btn.pack(pady=20)
            return

        for course in student_courses:
            course_card = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'],
                                       corner_radius=15)
            course_card.pack(fill="x", pady=10, padx=10)

            # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫—É—Ä—Å–∞
            header_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            header_frame.pack(fill="x", padx=20, pady=15)

            title_label = ctk.CTkLabel(header_frame, text=course['title'],
                                       font=("Segoe UI", 18, "bold"),
                                       text_color=COLORS['primary'])
            title_label.pack(side="left")

            progress_label = ctk.CTkLabel(header_frame, text=f"{course['progress']}%",
                                          font=("Segoe UI", 16, "bold"),
                                          text_color=COLORS['success'])
            progress_label.pack(side="right")

            # –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            progress_bar = ctk.CTkProgressBar(course_card, height=8,
                                              fg_color=COLORS['background'],
                                              progress_color=COLORS['success'])
            progress_bar.pack(fill="x", padx=20, pady=(0, 10))
            progress_bar.set(course['progress'] / 100)

            # –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            details_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            details_frame.pack(fill="x", padx=20, pady=(0, 15))

            stats = [
                f"üéØ –ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: {course['completed_lessons']}/{course['total_lessons']}",
                f"‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: {course['total_minutes']} –º–∏–Ω.",
                f"üìÖ –ó–∞–ø–∏—Å–∞–Ω: {course['enrolled_date']}"
            ]

            for stat in stats:
                stat_label = ctk.CTkLabel(details_frame, text=stat,
                                          font=("Segoe UI", 12),
                                          text_color=COLORS['text_secondary'])
                stat_label.pack(anchor="w", pady=2)

            # –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏
            actions_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            actions_frame.pack(fill="x", padx=20, pady=(0, 15))

            unenroll_btn = ctk.CTkButton(actions_frame, text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å",
                                         command=lambda cid=course['id']: self.unenroll_from_course(cid),
                                         height=35,
                                         fg_color="#FF6B6B",
                                         hover_color="#FF5252",
                                         font=("Segoe UI", 12, "bold"))
            unenroll_btn.pack(side="right")

    def unenroll_from_course(self, course_id):
        """–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–∞ –∫—É—Ä—Å"""
        result = messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
                                     "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ —ç—Ç–æ—Ç –∫—É—Ä—Å?\n–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")

        if result:
            success = unenroll_student_from_course(self.current_user['id'], course_id)
            if success:
                messagebox.showinfo("–£—Å–ø–µ—Ö", "–ó–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å –æ—Ç–º–µ–Ω–µ–Ω–∞!")
                self.show_my_courses()  # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            else:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å")

    def show_teacher_courses(self, parent):
        """–ö—É—Ä—Å—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è"""
        courses_container = ctk.CTkFrame(parent, fg_color="transparent")
        courses_container.pack(fill="both", expand=True)

        teacher_courses = get_teacher_courses(self.current_user['id'])

        if not teacher_courses:
            no_courses_frame = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'], corner_radius=15)
            no_courses_frame.pack(fill="both", expand=True, pady=20, padx=20)

            no_courses_label = ctk.CTkLabel(no_courses_frame,
                                            text="üìö –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤",
                                            font=("Segoe UI", 20, "bold"),
                                            text_color=COLORS['primary'])
            no_courses_label.pack(expand=True, pady=50)
            return

        for course in teacher_courses:
            course_card = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'],
                                       corner_radius=15)
            course_card.pack(fill="x", pady=10, padx=10)

            # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫—É—Ä—Å–∞
            header_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            header_frame.pack(fill="x", padx=20, pady=15)

            title_label = ctk.CTkLabel(header_frame, text=course['title'],
                                       font=("Segoe UI", 18, "bold"),
                                       text_color=COLORS['primary'])
            title_label.pack(side="left")

            students_label = ctk.CTkLabel(header_frame, text=f"üë• {course['student_count']} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                          font=("Segoe UI", 16, "bold"),
                                          text_color=COLORS['success'])
            students_label.pack(side="right")

            # –û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞
            desc_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            desc_frame.pack(fill="x", padx=20, pady=(0, 15))

            desc_label = ctk.CTkLabel(desc_frame, text=course['description'],
                                      font=("Segoe UI", 14),
                                      text_color=COLORS['text_secondary'],
                                      wraplength=1000, justify="left")
            desc_label.pack(anchor="w")

            # –î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞
            details_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            details_frame.pack(fill="x", padx=20, pady=(0, 15))

            stats = [
                f"üí∞ –¶–µ–Ω–∞: {course['price']} —Ä—É–±",
                f"üìä –£—Ä–æ–≤–µ–Ω—å: {course['level_name']}",
                f"‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {course['duration_hours']} —á–∞—Å–æ–≤",
                f"‚≠ê –†–µ–π—Ç–∏–Ω–≥: {course['avg_rating'] or '–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫'}"
            ]

            for stat in stats:
                stat_label = ctk.CTkLabel(details_frame, text=stat,
                                          font=("Segoe UI", 12),
                                          text_color=COLORS['text_secondary'])
                stat_label.pack(side="left", padx=20)

    def show_students(self):
        """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üë• –ú–æ–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        teacher_students = get_teacher_students(self.current_user['id'])

        if not teacher_students:
            no_students_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=15)
            no_students_frame.pack(fill="both", expand=True, pady=20)

            no_students_label = ctk.CTkLabel(no_students_frame,
                                             text="üë• –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                             font=("Segoe UI", 20, "bold"),
                                             text_color=COLORS['primary'])
            no_students_label.pack(expand=True, pady=50)
            return

        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        table_container = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        table_container.pack(fill="both", expand=True)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        headers_frame = ctk.CTkFrame(table_container, fg_color=COLORS['primary'], height=50)
        headers_frame.pack(fill="x", padx=10, pady=(10, 0))
        headers_frame.pack_propagate(False)

        headers = ["ID", "–ò–º—è", "–§–∞–º–∏–ª–∏—è", "Email", "–ö—É—Ä—Å", "–ü—Ä–æ–≥—Ä–µ—Å—Å"]
        widths = [50, 150, 150, 200, 250, 100]

        for i, (header, width) in enumerate(zip(headers, widths)):
            label = ctk.CTkLabel(headers_frame, text=header,
                                 font=("Segoe UI", 12, "bold"),
                                 text_color="white",
                                 width=width)
            label.place(x=sum(widths[:i]) + 5, y=15)

        # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        data_frame = ctk.CTkFrame(table_container, fg_color="transparent")
        data_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        for student in teacher_students:
            student_row = ctk.CTkFrame(data_frame, fg_color=COLORS['surface'],
                                       height=50, corner_radius=8)
            student_row.pack(fill="x", pady=2)
            student_row.pack_propagate(False)

            student_data = [
                str(student['student_id']),
                student['first_name'],
                student['last_name'],
                student['email'],
                student['course_title'],
                f"{student['progress']}%"
            ]

            for i, (text, width) in enumerate(zip(student_data, widths)):
                label = ctk.CTkLabel(student_row, text=text,
                                     font=("Segoe UI", 11),
                                     text_color=COLORS['text_primary'],
                                     width=width,
                                     anchor="w")
                label.place(x=sum(widths[:i]) + 5, y=15)

    def show_courses_admin(self):
        """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫—É—Ä—Å–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π —É–¥–∞–ª–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üìö –í—Å–µ –∫—É—Ä—Å—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞
        add_course_btn = ctk.CTkButton(content_frame, text="‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å",
                                       command=self.show_add_course,
                                       height=40,
                                       fg_color=COLORS['secondary'],
                                       text_color=COLORS['text_primary'],
                                       hover_color="#C8E830",
                                       font=("Segoe UI", 14, "bold"))
        add_course_btn.pack(anchor="e", pady=(0, 10))

        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫—É—Ä—Å—ã
        all_courses = get_all_courses_admin()

        if not all_courses:
            no_courses_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=15)
            no_courses_frame.pack(fill="both", expand=True, pady=20)

            no_courses_label = ctk.CTkLabel(no_courses_frame,
                                            text="üìö –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤",
                                            font=("Segoe UI", 20, "bold"),
                                            text_color=COLORS['primary'])
            no_courses_label.pack(expand=True, pady=50)
            return

        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        table_container = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        table_container.pack(fill="both", expand=True)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        headers_frame = ctk.CTkFrame(table_container, fg_color=COLORS['primary'], height=50)
        headers_frame.pack(fill="x", padx=10, pady=(10, 0))
        headers_frame.pack_propagate(False)

        headers = ["ID", "–ù–∞–∑–≤–∞–Ω–∏–µ", "–û–ø–∏—Å–∞–Ω–∏–µ", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "–¶–µ–Ω–∞", "–£—Ä–æ–≤–µ–Ω—å", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç—É–¥–µ–Ω—Ç–æ–≤",
                   "–†–µ–π—Ç–∏–Ω–≥", "–î–µ–π—Å—Ç–≤–∏—è"]
        widths = [50, 200, 250, 150, 100, 100, 120, 100, 100, 150]

        for i, (header, width) in enumerate(zip(headers, widths)):
            label = ctk.CTkLabel(headers_frame, text=header,
                                 font=("Segoe UI", 12, "bold"),
                                 text_color="white",
                                 width=width)
            label.place(x=sum(widths[:i]) + 5, y=15)

        # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
        data_frame = ctk.CTkFrame(table_container, fg_color="transparent")
        data_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫—É—Ä—Å—ã
        for course in all_courses:
            course_row = ctk.CTkFrame(data_frame, fg_color=COLORS['surface'],
                                      height=70, corner_radius=8)  # –£–≤–µ–ª–∏—á–∏–ª–∏ –≤—ã—Å–æ—Ç—É –¥–ª—è –∫–Ω–æ–ø–æ–∫
            course_row.pack(fill="x", pady=2)
            course_row.pack_propagate(False)

            # –î–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–∞
            course_data = [
                str(course['id']),
                course['title'][:30] + "..." if len(course['title']) > 30 else course['title'],
                course['description'][:50] + "..." if len(course['description']) > 50 else course['description'],
                course['instructor_name'],
                f"{course['price']} —Ä—É–±",
                course['level_name'],
                f"{course['duration_hours']} —á",
                str(course['student_count']),
                str(course['avg_rating']) if course['avg_rating'] else "–ù–µ—Ç"
            ]

            for i, (text, width) in enumerate(zip(course_data, widths[:-1])):  # –∫—Ä–æ–º–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                label = ctk.CTkLabel(course_row, text=text,
                                     font=("Segoe UI", 11),
                                     text_color=COLORS['text_primary'],
                                     width=width,
                                     anchor="w")
                label.place(x=sum(widths[:i]) + 5, y=25)

            # –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            actions_frame = ctk.CTkFrame(course_row, fg_color="transparent",
                                         width=widths[-1], height=50)
            actions_frame.place(x=sum(widths[:-1]) + 5, y=10)

            edit_btn = ctk.CTkButton(actions_frame, text="‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å",
                                     command=lambda cid=course['id']: self.show_edit_course(cid),
                                     height=35,
                                     fg_color=COLORS['warning'],
                                     hover_color="#F6AD55",
                                     font=("Segoe UI", 11, "bold"),
                                     width=80)
            edit_btn.pack(side="left", padx=2)

            delete_btn = ctk.CTkButton(actions_frame, text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å",
                                       command=lambda cid=course['id'], ctitle=course['title']: self.delete_course(cid,
                                                                                                                   ctitle),
                                       height=35,
                                       fg_color="#FF6B6B",
                                       hover_color="#FF5252",
                                       font=("Segoe UI", 11, "bold"),
                                       width=80)
            delete_btn.pack(side="left", padx=2)

    def show_edit_course(self, course_id):
        """–§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–∞"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–∞
        course = get_course_by_id(course_id)
        if not course:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ö—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω")
            self.show_courses_admin()
            return

        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        scrollable_frame = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        scrollable_frame.pack(fill="both", expand=True, pady=10)

        # –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–∞ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–π –æ–±–ª–∞—Å—Ç–∏
        form_frame = ctk.CTkFrame(scrollable_frame, fg_color="transparent")
        form_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # –ü–æ–ª—è —Ñ–æ—Ä–º—ã
        fields = [
            ("–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞", "edit_course_title"),
            ("–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞", "edit_course_description"),
            ("–¶–µ–Ω–∞ (—Ä—É–±)", "edit_course_price"),
            ("–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)", "edit_course_duration")
        ]

        self.edit_course_fields = {}
        for i, (label, field_name) in enumerate(fields):
            label_widget = ctk.CTkLabel(form_frame, text=label, font=("Segoe UI", 14))
            label_widget.pack(anchor="w", pady=(20, 5))

            if field_name == "edit_course_description":
                entry = ctk.CTkTextbox(form_frame, height=120, font=("Segoe UI", 14))
                entry.insert("1.0", course['description'])
            else:
                value = course['title'] if field_name == "edit_course_title" else str(
                    course['price']) if field_name == "edit_course_price" else str(course['duration_hours'])
                entry = ctk.CTkEntry(form_frame, font=("Segoe UI", 14), height=40)
                entry.insert(0, value)

            entry.pack(fill="x", pady=(0, 10))
            self.edit_course_fields[field_name] = entry

        # –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        level_label = ctk.CTkLabel(form_frame, text="–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏", font=("Segoe UI", 14))
        level_label.pack(anchor="w", pady=(10, 5))

        level_map = {1: "–ù–∞—á–∏–Ω–∞—é—â–∏–π", 2: "–°—Ä–µ–¥–Ω–∏–π", 3: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"}
        self.edit_course_level = ctk.CTkComboBox(form_frame,
                                                 values=["–ù–∞—á–∏–Ω–∞—é—â–∏–π", "–°—Ä–µ–¥–Ω–∏–π", "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"],
                                                 font=("Segoe UI", 14), height=40)
        self.edit_course_level.set(level_map.get(course['level'], "–ù–∞—á–∏–Ω–∞—é—â–∏–π"))
        self.edit_course_level.pack(fill="x", pady=(0, 10))

        # –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
        teacher_label = ctk.CTkLabel(form_frame, text="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", font=("Segoe UI", 14))
        teacher_label.pack(anchor="w", pady=(10, 5))

        teachers = get_teachers()
        teacher_names = [f"{t['first_name']} {t['last_name']}" for t in teachers]
        teacher_ids = [t['id'] for t in teachers]

        self.edit_course_instructor = ctk.CTkComboBox(form_frame,
                                                      values=teacher_names,
                                                      font=("Segoe UI", 14), height=40)

        # –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        current_instructor_name = course['instructor_name']
        if current_instructor_name in teacher_names:
            self.edit_course_instructor.set(current_instructor_name)
        elif teacher_names:
            self.edit_course_instructor.set(teacher_names[0])
        self.edit_course_instructor.pack(fill="x", pady=(0, 10))

        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        category_label = ctk.CTkLabel(form_frame, text="–ö–∞—Ç–µ–≥–æ—Ä–∏—è", font=("Segoe UI", 14))
        category_label.pack(anchor="w", pady=(10, 5))

        categories = get_categories()
        category_names = [cat['name'] for cat in categories]
        category_ids = [cat['id'] for cat in categories]

        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫—É—Ä—Å–∞
        current_categories = get_course_categories(course_id)
        current_category_names = [cat['name'] for cat in current_categories]

        self.edit_course_category = ctk.CTkComboBox(form_frame,
                                                    values=category_names,
                                                    font=("Segoe UI", 14), height=40)
        if current_category_names and current_category_names[0] in category_names:
            self.edit_course_category.set(current_category_names[0])
        elif category_names:
            self.edit_course_category.set(category_names[0])
        self.edit_course_category.pack(fill="x", pady=(0, 10))

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        self.edit_teachers_data = list(zip(teacher_names, teacher_ids))
        self.edit_categories_data = list(zip(category_names, category_ids))

        # –ö–Ω–æ–ø–∫–∏
        button_frame = ctk.CTkFrame(form_frame, fg_color="transparent")
        button_frame.pack(pady=30)

        save_btn = ctk.CTkButton(button_frame, text="üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è",
                                 command=lambda: self.update_course(course_id),
                                 height=50,
                                 fg_color=COLORS['primary'],
                                 hover_color=COLORS['accent'],
                                 font=("Segoe UI", 16, "bold"))
        save_btn.pack(side="left", padx=10)

        cancel_btn = ctk.CTkButton(button_frame, text="‚ùå –û—Ç–º–µ–Ω–∞",
                                   command=self.show_courses_admin,
                                   height=50,
                                   fg_color="#FF6B6B",
                                   hover_color="#FF5252",
                                   font=("Segoe UI", 16, "bold"))
        cancel_btn.pack(side="left", padx=10)

    def update_course(self, course_id):
        """–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–∞"""
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
        title = self.edit_course_fields['edit_course_title'].get().strip()
        description = self.edit_course_fields['edit_course_description'].get("1.0", "end-1c").strip()
        price = self.edit_course_fields['edit_course_price'].get().strip()
        duration = self.edit_course_fields['edit_course_duration'].get().strip()
        level = self.edit_course_level.get()
        instructor_name = self.edit_course_instructor.get()
        category_name = self.edit_course_category.get()

        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        if not all([title, description, price, duration]):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã")
            return

        try:
            price = float(price)
            duration = int(duration)
        except ValueError:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–¶–µ–Ω–∞ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏")
            return

        if price < 0:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π")
            return

        if duration <= 0:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
            return

        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ —á–∏—Å–ª–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
        level_map = {"–ù–∞—á–∏–Ω–∞—é—â–∏–π": 1, "–°—Ä–µ–¥–Ω–∏–π": 2, "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π": 3}
        level_num = level_map.get(level, 1)

        # –ù–∞—Ö–æ–¥–∏–º ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        instructor_id = None
        for name, id_val in self.edit_teachers_data:
            if name == instructor_name:
                instructor_id = id_val
                break

        if not instructor_id:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è")
            return

        # –û–±–Ω–æ–≤–ª—è–µ–º –∫—É—Ä—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        success = update_course(course_id, title, description, price, level_num, duration, instructor_id)

        if success:
            # –ù–∞—Ö–æ–¥–∏–º ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑—å
            category_id = None
            for name, id_val in self.edit_categories_data:
                if name == category_name:
                    category_id = id_val
                    break

            if category_id:
                update_course_categories(course_id, [category_id])

            messagebox.showinfo("–£—Å–ø–µ—Ö", "–ö—É—Ä—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!")
            self.show_courses_admin()  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ø–∏—Å–∫—É –∫—É—Ä—Å–æ–≤
        else:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å")

    def delete_course(self, course_id, course_title):
        """–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å"""
        result = messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è",
                                     f"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å \"{course_title}\"?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!")
        if result:
            success = delete_course(course_id)
            if success:
                messagebox.showinfo("–£—Å–ø–µ—Ö", "–ö—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!")
                self.show_courses_admin()  # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            else:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å")

    def show_enrollments_admin(self):
        """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫—É—Ä—Å—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üìã –ó–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å—ã",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∞
        refresh_btn = ctk.CTkButton(content_frame, text="üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                                    command=self.show_enrollments_admin,
                                    height=40,
                                    fg_color=COLORS['secondary'],
                                    text_color=COLORS['text_primary'],
                                    hover_color="#C8E830",
                                    font=("Segoe UI", 14, "bold"))
        refresh_btn.pack(anchor="e", pady=(0, 10))

        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏
        enrollments = get_all_enrollments()

        if not enrollments:
            no_enrollments_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=15)
            no_enrollments_frame.pack(fill="both", expand=True, pady=20)

            no_enrollments_label = ctk.CTkLabel(no_enrollments_frame,
                                                text="üìã –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫—É—Ä—Å—ã",
                                                font=("Segoe UI", 20, "bold"),
                                                text_color=COLORS['primary'])
            no_enrollments_label.pack(expand=True, pady=50)
            return

        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        table_container = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        table_container.pack(fill="both", expand=True)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        headers_frame = ctk.CTkFrame(table_container, fg_color=COLORS['primary'], height=50)
        headers_frame.pack(fill="x", padx=10, pady=(10, 0))
        headers_frame.pack_propagate(False)

        headers = ["ID –∑–∞–ø–∏—Å–∏", "–°—Ç—É–¥–µ–Ω—Ç", "Email", "–ö—É—Ä—Å", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏", "–ü—Ä–æ–≥—Ä–µ—Å—Å", "–î–µ–π—Å—Ç–≤–∏—è"]
        widths = [100, 150, 200, 250, 150, 150, 100, 150]

        for i, (header, width) in enumerate(zip(headers, widths)):
            label = ctk.CTkLabel(headers_frame, text=header,
                                 font=("Segoe UI", 12, "bold"),
                                 text_color="white",
                                 width=width)
            label.place(x=sum(widths[:i]) + 5, y=15)

        # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
        data_frame = ctk.CTkFrame(table_container, fg_color="transparent")
        data_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–ø–∏—Å–∏
        for enrollment in enrollments:
            enrollment_row = ctk.CTkFrame(data_frame, fg_color=COLORS['surface'],
                                          height=60, corner_radius=8)
            enrollment_row.pack(fill="x", pady=2)
            enrollment_row.pack_propagate(False)

            enrollment_data = [
                str(enrollment['enrollment_id']),
                enrollment['student_name'],
                enrollment['student_email'],
                enrollment['course_title'][:40] + "..." if len(enrollment['course_title']) > 40 else enrollment[
                    'course_title'],
                enrollment['instructor_name'],
                enrollment['enrolled_date'][:16],
                f"{enrollment['progress']}%"
            ]

            for i, (text, width) in enumerate(zip(enrollment_data, widths[:-1])):  # –∫—Ä–æ–º–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                label = ctk.CTkLabel(enrollment_row, text=text,
                                     font=("Segoe UI", 11),
                                     text_color=COLORS['text_primary'],
                                     width=width,
                                     anchor="w")
                label.place(x=sum(widths[:i]) + 5, y=20)

            # –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            actions_frame = ctk.CTkFrame(enrollment_row, fg_color="transparent",
                                         width=widths[-1], height=40)
            actions_frame.place(x=sum(widths[:-1]) + 5, y=10)

            delete_btn = ctk.CTkButton(actions_frame, text="‚ùå –£–¥–∞–ª–∏—Ç—å",
                                       command=lambda eid=enrollment['enrollment_id']: self.delete_enrollment(eid),
                                       height=35,
                                       fg_color="#FF6B6B",
                                       hover_color="#FF5252",
                                       font=("Segoe UI", 11, "bold"),
                                       width=80)
            delete_btn.pack(side="left", padx=2)

    def delete_enrollment(self, enrollment_id):
        """–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å"""
        result = messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
                                     "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å?\n–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")

        if result:
            success = delete_enrollment(enrollment_id)
            if success:
                messagebox.showinfo("–£—Å–ø–µ—Ö", "–ó–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å —É–¥–∞–ª–µ–Ω–∞!")
                self.show_enrollments_admin()  # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            else:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å")

    def show_finances(self):
        """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥–æ–≤
        finance_stats = get_finance_statistics()
        stats_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        stats_frame.pack(fill="x", pady=(0, 20))

        stats_data = [
            ("üí∞ –û–±—â–∏–π –¥–æ—Ö–æ–¥", f"{finance_stats['total_revenue']} —Ä—É–±", COLORS['primary']),
            ("‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π", finance_stats['completed_payments'], COLORS['success']),
            ("‚è≥ –û–∂–∏–¥–∞—é—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π", finance_stats['pending_payments'], COLORS['warning']),
            ("üìä –°—Ä–µ–¥–Ω–∏–π —á–µ–∫", f"{finance_stats['avg_payment']} —Ä—É–±", COLORS['secondary'])
        ]

        for title, value, color in stats_data:
            stat_card = ctk.CTkFrame(stats_frame, fg_color="transparent")
            stat_card.pack(side="left", fill="both", expand=True, padx=15, pady=15)

            value_label = ctk.CTkLabel(stat_card, text=str(value),
                                       font=("Segoe UI", 16, "bold"),
                                       text_color=color)
            value_label.pack()

            title_label = ctk.CTkLabel(stat_card, text=title,
                                       font=("Segoe UI", 12),
                                       text_color=COLORS['text_secondary'])
            title_label.pack()

        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏
        all_payments = get_all_payments()

        if not all_payments:
            no_payments_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=15)
            no_payments_frame.pack(fill="both", expand=True, pady=20)

            no_payments_label = ctk.CTkLabel(no_payments_frame,
                                             text="üí∞ –ü–æ–∫–∞ –Ω–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π",
                                             font=("Segoe UI", 20, "bold"),
                                             text_color=COLORS['primary'])
            no_payments_label.pack(expand=True, pady=50)
            return

        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        table_container = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        table_container.pack(fill="both", expand=True)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        headers_frame = ctk.CTkFrame(table_container, fg_color=COLORS['primary'], height=50)
        headers_frame.pack(fill="x", padx=10, pady=(10, 0))
        headers_frame.pack_propagate(False)

        headers = ["ID", "–°—Ç—É–¥–µ–Ω—Ç", "–ö—É—Ä—Å", "–°—É–º–º–∞", "–°—Ç–∞—Ç—É—Å", "–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã", "–î–∞—Ç–∞"]
        widths = [50, 200, 250, 100, 120, 150, 150]

        for i, (header, width) in enumerate(zip(headers, widths)):
            label = ctk.CTkLabel(headers_frame, text=header,
                                 font=("Segoe UI", 12, "bold"),
                                 text_color="white",
                                 width=width)
            label.place(x=sum(widths[:i]) + 5, y=15)

        # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
        data_frame = ctk.CTkFrame(table_container, fg_color="transparent")
        data_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–ª–∞—Ç–µ–∂–∏
        for payment in all_payments:
            payment_row = ctk.CTkFrame(data_frame, fg_color=COLORS['surface'],
                                       height=50, corner_radius=8)
            payment_row.pack(fill="x", pady=2)
            payment_row.pack_propagate(False)

            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞
            status_color = COLORS['success'] if payment['status'] == 'completed' else COLORS['warning']

            payment_data = [
                str(payment['id']),
                payment['student_name'],
                payment['course_title'][:40] + "..." if len(payment['course_title']) > 40 else payment['course_title'],
                f"{payment['amount']} —Ä—É–±",
                payment['status'],
                payment['payment_method'],
                payment['created_at'][:16]  # –û–±—Ä–µ–∑–∞–µ–º –¥–æ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            ]

            for i, (text, width) in enumerate(zip(payment_data, widths)):
                if i == 4:  # –°—Ç–∞—Ç—É—Å
                    label = ctk.CTkLabel(payment_row, text=text,
                                         font=("Segoe UI", 11, "bold"),
                                         text_color=status_color,
                                         width=width,
                                         anchor="w")
                else:
                    label = ctk.CTkLabel(payment_row, text=text,
                                         font=("Segoe UI", 11),
                                         text_color=COLORS['text_primary'],
                                         width=width,
                                         anchor="w")
                label.place(x=sum(widths[:i]) + 5, y=15)

    def show_users(self):
        """–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        stats_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        stats_frame.pack(fill="x", pady=(0, 20))

        users_stats = get_users_statistics()

        stats_data = [
            ("üë§ –í—Å–µ–≥–æ", users_stats['total'], COLORS['primary']),
            ("üéì –°—Ç—É–¥–µ–Ω—Ç—ã", users_stats['students'], COLORS['success']),
            ("üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏", users_stats['teachers'], COLORS['warning']),
            ("‚öôÔ∏è –ê–¥–º–∏–Ω—ã", users_stats['admins'], COLORS['secondary'])
        ]

        for title, value, color in stats_data:
            stat_card = ctk.CTkFrame(stats_frame, fg_color="transparent")
            stat_card.pack(side="left", fill="both", expand=True, padx=15, pady=15)

            value_label = ctk.CTkLabel(stat_card, text=str(value),
                                       font=("Segoe UI", 24, "bold"),
                                       text_color=color)
            value_label.pack()

            title_label = ctk.CTkLabel(stat_card, text=title,
                                       font=("Segoe UI", 12),
                                       text_color=COLORS['text_secondary'])
            title_label.pack()

        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        users = get_all_users()

        if not users:
            no_users_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=15)
            no_users_frame.pack(fill="both", expand=True, pady=20)

            no_users_label = ctk.CTkLabel(no_users_frame,
                                          text="üë• –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
                                          font=("Segoe UI", 20, "bold"),
                                          text_color=COLORS['primary'])
            no_users_label.pack(expand=True, pady=50)
            return

        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        table_container = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        table_container.pack(fill="both", expand=True)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        headers_frame = ctk.CTkFrame(table_container, fg_color=COLORS['primary'], height=50)
        headers_frame.pack(fill="x", padx=10, pady=(10, 0))
        headers_frame.pack_propagate(False)

        headers = ["ID", "–ò–º—è", "–§–∞–º–∏–ª–∏—è", "Email", "–†–æ–ª—å", "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏", "–ë–∏–æ–≥—Ä–∞—Ñ–∏—è", "–î–µ–π—Å—Ç–≤–∏—è"]
        widths = [80, 120, 120, 200, 120, 150, 300, 150]

        for i, (header, width) in enumerate(zip(headers, widths)):
            label = ctk.CTkLabel(headers_frame, text=header,
                                 font=("Segoe UI", 12, "bold"),
                                 text_color="white",
                                 width=width)
            label.place(x=sum(widths[:i]) + 5, y=15)

        # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        data_frame = ctk.CTkFrame(table_container, fg_color="transparent")
        data_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        for user in users:
            # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ None
            if user is None:
                continue

            user_row = ctk.CTkFrame(data_frame, fg_color=COLORS['surface'],
                                    height=70, corner_radius=8)
            user_row.pack(fill="x", pady=2)
            user_row.pack_propagate(False)

            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç —Ä–æ–ª–∏
            role_colors = {
                '–°—Ç—É–¥–µ–Ω—Ç': COLORS['primary'],
                '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å': COLORS['success'],
                '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä': COLORS['warning']
            }

            # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ role_name
            role_name = user.get('role_name', '–ù–µ —É–∫–∞–∑–∞–Ω–∞')
            role_color = role_colors.get(role_name, COLORS['text_primary'])

            user_data = [
                str(user.get('id', '')),
                user.get('first_name', ''),
                user.get('last_name', ''),
                user.get('email', ''),
                role_name,
                user.get('created_at', '')[:16] if user.get('created_at') else '–ù–µ —É–∫–∞–∑–∞–Ω–∞',
                (user.get('bio', '')[:50] + "...") if len(user.get('bio', '')) > 50 else user.get('bio', '')
            ]

            for i, (text, width) in enumerate(zip(user_data, widths[:-1])):  # –∫—Ä–æ–º–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                if i == 4:  # –†–æ–ª—å
                    label = ctk.CTkLabel(user_row, text=text,
                                         font=("Segoe UI", 11, "bold"),
                                         text_color=role_color,
                                         width=width,
                                         anchor="w")
                else:
                    label = ctk.CTkLabel(user_row, text=text,
                                         font=("Segoe UI", 11),
                                         text_color=COLORS['text_primary'],
                                         width=width,
                                         anchor="w")
                label.place(x=sum(widths[:i]) + 5, y=25)

            # –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            actions_frame = ctk.CTkFrame(user_row, fg_color="transparent",
                                         width=widths[-1], height=50)
            actions_frame.place(x=sum(widths[:-1]) + 5, y=10)

            user_id = user.get('id')
            user_name = f"{user.get('first_name', '')} {user.get('last_name', '')}"

            edit_btn = ctk.CTkButton(actions_frame, text="‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å",
                                     command=lambda uid=user_id: self.show_edit_user(uid),
                                     height=35,
                                     fg_color=COLORS['warning'],
                                     hover_color="#F6AD55",
                                     font=("Segoe UI", 11, "bold"),
                                     width=70)
            edit_btn.pack(side="left", padx=2)

            delete_btn = ctk.CTkButton(actions_frame, text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å",
                                       command=lambda uid=user_id, uname=user_name: self.delete_user(uid, uname),
                                       height=35,
                                       fg_color="#FF6B6B",
                                       hover_color="#FF5252",
                                       font=("Segoe UI", 11, "bold"),
                                       width=70)
            delete_btn.pack(side="left", padx=2)

    def show_edit_user(self, user_id):
        """–§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user = get_user_by_id(user_id)
        if not user:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
            self.show_users()
            return

        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        scrollable_frame = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        scrollable_frame.pack(fill="both", expand=True, pady=10)

        # –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        form_frame = ctk.CTkFrame(scrollable_frame, fg_color="transparent")
        form_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # –ü–æ–ª—è —Ñ–æ—Ä–º—ã
        fields = [
            ("–ò–º—è", "edit_user_first_name"),
            ("–§–∞–º–∏–ª–∏—è", "edit_user_last_name"),
            ("Email", "edit_user_email")
        ]

        self.edit_user_fields = {}
        for i, (label, field_name) in enumerate(fields):
            label_widget = ctk.CTkLabel(form_frame, text=label, font=("Segoe UI", 14))
            label_widget.pack(anchor="w", pady=(20, 5))

            value = user['first_name'] if field_name == "edit_user_first_name" else user[
                'last_name'] if field_name == "edit_user_last_name" else user['email']
            entry = ctk.CTkEntry(form_frame, font=("Segoe UI", 14), height=40)
            entry.insert(0, value)
            entry.pack(fill="x", pady=(0, 10))
            self.edit_user_fields[field_name] = entry

        # –†–æ–ª—å
        role_label = ctk.CTkLabel(form_frame, text="–†–æ–ª—å", font=("Segoe UI", 14))
        role_label.pack(anchor="w", pady=(10, 5))

        self.edit_user_role = ctk.CTkComboBox(form_frame,
                                              values=["–°—Ç—É–¥–µ–Ω—Ç", "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "–ê–¥–º–∏–Ω"],
                                              font=("Segoe UI", 14), height=40)
        self.edit_user_role.set(user['role_name'])
        self.edit_user_role.pack(fill="x", pady=(0, 10))

        # –û —Å–µ–±–µ
        bio_label = ctk.CTkLabel(form_frame, text="–û —Å–µ–±–µ:", font=("Segoe UI", 14))
        bio_label.pack(anchor="w", pady=(10, 5))

        self.edit_user_bio = ctk.CTkTextbox(form_frame, height=120, font=("Segoe UI", 14))
        self.edit_user_bio.insert("1.0", user['bio'])
        self.edit_user_bio.pack(fill="x", pady=(0, 10))

        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∞—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        info_label = ctk.CTkLabel(form_frame, text=f"–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {user['created_at']}",
                                  font=("Segoe UI", 12),
                                  text_color=COLORS['text_secondary'])
        info_label.pack(anchor="w", pady=(10, 5))

        # –ö–Ω–æ–ø–∫–∏
        button_frame = ctk.CTkFrame(form_frame, fg_color="transparent")
        button_frame.pack(pady=30)

        save_btn = ctk.CTkButton(button_frame, text="üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è",
                                 command=lambda: self.update_user(user_id),
                                 height=50,
                                 fg_color=COLORS['primary'],
                                 hover_color=COLORS['accent'],
                                 font=("Segoe UI", 16, "bold"))
        save_btn.pack(side="left", padx=10)

        cancel_btn = ctk.CTkButton(button_frame, text="‚ùå –û—Ç–º–µ–Ω–∞",
                                   command=self.show_users,
                                   height=50,
                                   fg_color="#FF6B6B",
                                   hover_color="#FF5252",
                                   font=("Segoe UI", 16, "bold"))
        cancel_btn.pack(side="left", padx=10)

    def update_user(self, user_id):
        """–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
        first_name = self.edit_user_fields['edit_user_first_name'].get().strip()
        last_name = self.edit_user_fields['edit_user_last_name'].get().strip()
        email = self.edit_user_fields['edit_user_email'].get().strip()
        role = self.edit_user_role.get()
        bio = self.edit_user_bio.get("1.0", "end-1c").strip()

        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        if not all([first_name, last_name, email]):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã")
            return

        if len(first_name) < 2:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 2 —Å–∏–º–≤–æ–ª–æ–≤")
            return

        if not EMAIL_REGEX.match(email):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email-–∞–¥—Ä–µ—Å")
            return

        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        success = update_user(user_id, first_name, last_name, email, role, bio)

        if success:
            messagebox.showinfo("–£—Å–ø–µ—Ö", "–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
            self.show_users()  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        else:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")

    def delete_user(self, user_id, user_name):
        """–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if user_id == self.current_user['id']:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç!")
            return

        result = messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è",
                                     f"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è \"{user_name}\"?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!")
        if result:
            success = delete_user(user_id)
            if success:
                messagebox.showinfo("–£—Å–ø–µ—Ö", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!")
                self.show_users()  # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            else:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")

    def show_course_catalog(self):
        """–ö–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –∫—É—Ä—Å–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="üìñ –ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –§–∏–ª—å—Ç—Ä—ã
        filters_frame = ctk.CTkFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        filters_frame.pack(fill="x", pady=(0, 20))

        filter_label = ctk.CTkLabel(filters_frame, text="–§–∏–ª—å—Ç—Ä—ã:",
                                    font=("Segoe UI", 14, "bold"))
        filter_label.pack(side="left", padx=20, pady=15)

        # –£—Ä–æ–≤–µ–Ω—å
        self.level_filter = ctk.CTkComboBox(filters_frame,
                                            values=["–í—Å–µ —É—Ä–æ–≤–Ω–∏", "–ù–∞—á–∏–Ω–∞—é—â–∏–π", "–°—Ä–µ–¥–Ω–∏–π", "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"],
                                            width=150)
        self.level_filter.set("–í—Å–µ —É—Ä–æ–≤–Ω–∏")
        self.level_filter.pack(side="left", padx=10)

        # –ö–∞—Ç–µ–≥–æ—Ä–∏—è
        self.category_filter = ctk.CTkComboBox(filters_frame,
                                               values=["–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
                                                       "Data Science", "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö", "–ú–æ–±–∏–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞"],
                                               width=180)
        self.category_filter.set("–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")
        self.category_filter.pack(side="left", padx=10)

        # –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        apply_filter_btn = ctk.CTkButton(filters_frame, text="–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",
                                         command=self.apply_filters, height=35,
                                         fg_color=COLORS['primary'],
                                         hover_color=COLORS['accent'],
                                         font=("Segoe UI", 12))
        apply_filter_btn.pack(side="left", padx=10)

        # –°–µ—Ç–∫–∞ –∫—É—Ä—Å–æ–≤
        self.courses_grid = ctk.CTkScrollableFrame(content_frame, fg_color="transparent")
        self.courses_grid.pack(fill="both", expand=True)

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—É—Ä—Å—ã
        self.apply_filters()

    def apply_filters(self):
        """–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫—É—Ä—Å–æ–≤"""
        # –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É –∫—É—Ä—Å–æ–≤
        for widget in self.courses_grid.winfo_children():
            widget.destroy()

        # –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
        level_filter = self.level_filter.get()
        category_filter = self.category_filter.get()

        # –ü–æ–ª—É—á–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã
        filtered_courses = get_filtered_courses(level_filter, category_filter)

        if not filtered_courses:
            no_courses_label = ctk.CTkLabel(self.courses_grid, text="–ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
                                            font=("Segoe UI", 16),
                                            text_color=COLORS['text_secondary'])
            no_courses_label.pack(expand=True, pady=50)
            return

        # –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É 2x2
        row_frame = None
        for i, course in enumerate(filtered_courses):
            if i % 2 == 0:
                row_frame = ctk.CTkFrame(self.courses_grid, fg_color="transparent")
                row_frame.pack(fill="x", pady=10)

            course_card = self.create_course_card(course, row_frame)
            course_card.pack(side="left", fill="both", expand=True, padx=10)

    def create_course_card(self, course, parent):
        """–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫—É—Ä—Å–∞"""
        card = ctk.CTkFrame(parent, fg_color=COLORS['surface'], corner_radius=15)
        card.configure(border_width=1, border_color=COLORS['primary'])

        # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (–∑–∞–≥–ª—É—à–∫–∞)
        image_frame = ctk.CTkFrame(card, fg_color=COLORS['primary'], height=120)
        image_frame.pack(fill="x", padx=10, pady=10)
        image_frame.pack_propagate(False)

        image_label = ctk.CTkLabel(image_frame, text="üéì",
                                   font=("Segoe UI", 40),
                                   text_color="white")
        image_label.pack(expand=True)

        # –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
        content_frame = ctk.CTkFrame(card, fg_color="transparent")
        content_frame.pack(fill="both", expand=True, padx=15, pady=10)

        title_label = ctk.CTkLabel(content_frame, text=course['title'],
                                   font=("Segoe UI", 16, "bold"),
                                   text_color=COLORS['text_primary'])
        title_label.pack(anchor="w", pady=(0, 8))

        desc_label = ctk.CTkLabel(content_frame, text=course['description'][:100] + "...",
                                  font=("Segoe UI", 12),
                                  text_color=COLORS['text_secondary'],
                                  wraplength=300, justify="left")
        desc_label.pack(anchor="w", pady=(0, 10))

        # –ú–µ—Çadata
        meta_frame = ctk.CTkFrame(content_frame, fg_color="transparent")
        meta_frame.pack(fill="x", pady=(0, 15))

        level_label = ctk.CTkLabel(meta_frame, text=f"üìä {course['level_name']}",
                                   font=("Segoe UI", 11))
        level_label.pack(side="left")

        duration_label = ctk.CTkLabel(meta_frame, text=f"‚è±Ô∏è {course['duration_hours']}—á",
                                      font=("Segoe UI", 11))
        duration_label.pack(side="right")

        # –¶–µ–Ω–∞ –∏ –∫–Ω–æ–ø–∫–∞
        price_frame = ctk.CTkFrame(content_frame, fg_color="transparent")
        price_frame.pack(fill="x")

        price_label = ctk.CTkLabel(price_frame, text=f"üí∞ {course['price']} —Ä—É–±",
                                   font=("Segoe UI", 14, "bold"),
                                   text_color=COLORS['primary'])
        price_label.pack(side="left")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–∏—Å–∞–Ω –ª–∏ —É–∂–µ —Å—Ç—É–¥–µ–Ω—Ç –Ω–∞ —ç—Ç–æ—Ç –∫—É—Ä—Å
        is_enrolled = is_student_enrolled(self.current_user['id'], course['id'])

        if is_enrolled:
            enroll_btn = ctk.CTkButton(price_frame, text="‚úÖ –ó–∞–ø–∏—Å–∞–Ω",
                                       height=35,
                                       fg_color=COLORS['success'],
                                       font=("Segoe UI", 12, "bold"),
                                       state="disabled")
        else:
            enroll_btn = ctk.CTkButton(price_frame, text="–ó–∞–ø–∏—Å–∞—Ç—å—Å—è",
                                       height=35,
                                       fg_color=COLORS['secondary'],
                                       text_color=COLORS['text_primary'],
                                       hover_color="#C8E830",
                                       font=("Segoe UI", 12, "bold"),
                                       command=lambda cid=course['id']: self.enroll_in_course(cid))
        enroll_btn.pack(side="right")

        return card

    def enroll_in_course(self, course_id):
        """–ó–∞–ø–∏—Å–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–∞ –∫—É—Ä—Å"""
        try:
            success = enroll_student_in_course(self.current_user['id'], course_id)
            if success:
                messagebox.showinfo("–£—Å–ø–µ—Ö", "–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫—É—Ä—Å!")
                self.show_course_catalog()  # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–∞–ª–æ–≥
            else:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å")
        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å: {e}")

    def show_all_courses_admin(self, parent):
        """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫—É—Ä—Å—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        courses_container = ctk.CTkFrame(parent, fg_color="transparent")
        courses_container.pack(fill="both", expand=True)

        all_courses = get_all_courses_admin()

        if not all_courses:
            no_courses_frame = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'], corner_radius=15)
            no_courses_frame.pack(fill="both", expand=True, pady=20, padx=20)

            no_courses_label = ctk.CTkLabel(no_courses_frame,
                                            text="üìö –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤",
                                            font=("Segoe UI", 20, "bold"),
                                            text_color=COLORS['primary'])
            no_courses_label.pack(expand=True, pady=50)
            return

        for course in all_courses:
            course_card = ctk.CTkFrame(courses_container, fg_color=COLORS['surface'],
                                       corner_radius=15)
            course_card.pack(fill="x", pady=10, padx=10)

            # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫—É—Ä—Å–∞
            header_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            header_frame.pack(fill="x", padx=20, pady=15)

            title_label = ctk.CTkLabel(header_frame, text=course['title'],
                                       font=("Segoe UI", 18, "bold"),
                                       text_color=COLORS['primary'])
            title_label.pack(side="left")

            stats_label = ctk.CTkLabel(header_frame,
                                       text=f"üë• {course['student_count']} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ | ‚≠ê {course['avg_rating'] or '–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫'}",
                                       font=("Segoe UI", 14),
                                       text_color=COLORS['text_secondary'])
            stats_label.pack(side="right")

            # –û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞
            desc_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            desc_frame.pack(fill="x", padx=20, pady=(0, 15))

            desc_label = ctk.CTkLabel(desc_frame, text=course['description'],
                                      font=("Segoe UI", 14),
                                      text_color=COLORS['text_secondary'],
                                      wraplength=1000, justify="left")
            desc_label.pack(anchor="w")

            # –î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞
            details_frame = ctk.CTkFrame(course_card, fg_color="transparent")
            details_frame.pack(fill="x", padx=20, pady=(0, 15))

            stats = [
                f"üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {course['instructor_name']}",
                f"üí∞ –¶–µ–Ω–∞: {course['price']} —Ä—É–±",
                f"üìä –£—Ä–æ–≤–µ–Ω—å: {course['level_name']}",
                f"‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {course['duration_hours']} —á–∞—Å–æ–≤"
            ]

            for stat in stats:
                stat_label = ctk.CTkLabel(details_frame, text=stat,
                                          font=("Segoe UI", 12),
                                          text_color=COLORS['text_secondary'])
                stat_label.pack(side="left", padx=20)

    def show_add_course(self):
        """–§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π"""
        self.clear_window()
        self.create_navigation()

        content_frame = ctk.CTkFrame(self.root, fg_color=COLORS['background'])
        content_frame.pack(fill="both", expand=True, padx=20, pady=20)

        title_label = ctk.CTkLabel(content_frame, text="‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å",
                                   font=("Segoe UI", 24, "bold"),
                                   text_color=COLORS['primary'])
        title_label.pack(anchor="w", pady=(0, 20))

        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        scrollable_frame = ctk.CTkScrollableFrame(content_frame, fg_color=COLORS['surface'], corner_radius=12)
        scrollable_frame.pack(fill="both", expand=True, pady=10)

        # –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–π –æ–±–ª–∞—Å—Ç–∏
        form_frame = ctk.CTkFrame(scrollable_frame, fg_color="transparent")
        form_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # –ü–æ–ª—è —Ñ–æ—Ä–º—ã
        fields = [
            ("–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞", "course_title"),
            ("–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞", "course_description"),
            ("–¶–µ–Ω–∞ (—Ä—É–±)", "course_price"),
            ("–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)", "course_duration")
        ]

        self.course_fields = {}
        for i, (label, field_name) in enumerate(fields):
            label_widget = ctk.CTkLabel(form_frame, text=label, font=("Segoe UI", 14))
            label_widget.pack(anchor="w", pady=(20, 5))

            if field_name == "course_description":
                entry = ctk.CTkTextbox(form_frame, height=120, font=("Segoe UI", 14))  # –£–≤–µ–ª–∏—á–∏–ª–∏ –≤—ã—Å–æ—Ç—É
            else:
                entry = ctk.CTkEntry(form_frame, font=("Segoe UI", 14), height=40)

            entry.pack(fill="x", pady=(0, 10))
            self.course_fields[field_name] = entry

        # –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        level_label = ctk.CTkLabel(form_frame, text="–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏", font=("Segoe UI", 14))
        level_label.pack(anchor="w", pady=(10, 5))

        self.course_level = ctk.CTkComboBox(form_frame,
                                            values=["–ù–∞—á–∏–Ω–∞—é—â–∏–π", "–°—Ä–µ–¥–Ω–∏–π", "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"],
                                            font=("Segoe UI", 14), height=40)
        self.course_level.set("–ù–∞—á–∏–Ω–∞—é—â–∏–π")
        self.course_level.pack(fill="x", pady=(0, 10))

        # –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
        teacher_label = ctk.CTkLabel(form_frame, text="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", font=("Segoe UI", 14))
        teacher_label.pack(anchor="w", pady=(10, 5))

        teachers = get_teachers()
        teacher_names = [f"{t['first_name']} {t['last_name']}" for t in teachers]
        teacher_ids = [t['id'] for t in teachers]

        self.course_instructor = ctk.CTkComboBox(form_frame,
                                                 values=teacher_names,
                                                 font=("Segoe UI", 14), height=40)
        if teacher_names:
            self.course_instructor.set(teacher_names[0])
        self.course_instructor.pack(fill="x", pady=(0, 10))

        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        category_label = ctk.CTkLabel(form_frame, text="–ö–∞—Ç–µ–≥–æ—Ä–∏—è", font=("Segoe UI", 14))
        category_label.pack(anchor="w", pady=(10, 5))

        categories = get_categories()
        category_names = [cat['name'] for cat in categories]
        category_ids = [cat['id'] for cat in categories]

        self.course_category = ctk.CTkComboBox(form_frame,
                                               values=category_names,
                                               font=("Segoe UI", 14), height=40)
        if category_names:
            self.course_category.set(category_names[0])
        self.course_category.pack(fill="x", pady=(0, 10))

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        self.teachers_data = list(zip(teacher_names, teacher_ids))
        self.categories_data = list(zip(category_names, category_ids))

        # –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        add_btn = ctk.CTkButton(form_frame, text="–î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å",
                                command=self.add_new_course,
                                height=50,
                                fg_color=COLORS['primary'],
                                hover_color=COLORS['accent'],
                                font=("Segoe UI", 16, "bold"))
        add_btn.pack(pady=30)  # –£–≤–µ–ª–∏—á–∏–ª–∏ –æ—Ç—Å—Ç—É–ø

    def add_new_course(self):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
        title = self.course_fields['course_title'].get().strip()
        description = self.course_fields['course_description'].get("1.0", "end-1c").strip()
        price = self.course_fields['course_price'].get().strip()
        duration = self.course_fields['course_duration'].get().strip()
        level = self.course_level.get()
        instructor_name = self.course_instructor.get()
        category_name = self.course_category.get()

        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        if not all([title, description, price, duration]):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã")
            return

        try:
            price = float(price)
            duration = int(duration)
        except ValueError:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–¶–µ–Ω–∞ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏")
            return

        if price < 0:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π")
            return

        if duration <= 0:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
            return

        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ —á–∏—Å–ª–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
        level_map = {"–ù–∞—á–∏–Ω–∞—é—â–∏–π": 1, "–°—Ä–µ–¥–Ω–∏–π": 2, "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π": 3}
        level_num = level_map.get(level, 1)

        # –ù–∞—Ö–æ–¥–∏–º ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        instructor_id = None
        for name, id_val in self.teachers_data:
            if name == instructor_name:
                instructor_id = id_val
                break

        if not instructor_id:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è")
            return

        # –î–æ–±–∞–≤–ª—è–µ–º –∫—É—Ä—Å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        success = add_course(title, description, price, level_num, duration, instructor_id)

        if success:
            # –ü–æ–ª—É—á–∞–µ–º ID –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞
            course_id = get_last_course_id()

            # –ù–∞—Ö–æ–¥–∏–º ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å
            category_id = None
            for name, id_val in self.categories_data:
                if name == category_name:
                    category_id = id_val
                    break

            if category_id:
                add_course_category(course_id, category_id)

            messagebox.showinfo("–£—Å–ø–µ—Ö", "–ö—É—Ä—Å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!")
            self.show_courses_admin()  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ø–∏—Å–∫—É –∫—É—Ä—Å–æ–≤
        else:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å")

    def login(self):
        email = self.login_email.get().strip()
        password = self.login_password.get()

        if not email or not password:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è")
            return

        try:
            user = authenticate_user(email, password)
            if user:
                self.current_user = {
                    'id': user['id'],
                    'first_name': user['first_name'],
                    'last_name': user['last_name'],
                    'email': user['email'],
                    'role': user['role_name']
                }
                self.show_main_page()
            else:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å")
        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ: {e}")

    def register(self):
        data = {
            'first_name': self.reg_first_name.get().strip(),
            'last_name': self.reg_last_name.get().strip(),
            'email': self.reg_email.get().strip(),
            'password': self.reg_password.get(),
            'role': self.reg_role.get(),
            'bio': self.reg_bio.get("1.0", "end-1c").strip()
        }

        if not all([data['first_name'], data['last_name'], data['email'], data['password']]):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è")
            return

        if len(data['first_name']) < 2:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 2 —Å–∏–º–≤–æ–ª–æ–≤")
            return

        if len(data['password']) < 6:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤")
            return

        if not EMAIL_REGEX.match(data['email']):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email-–∞–¥—Ä–µ—Å")
            return

        try:
            if find_user_by_email(data['email']):
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
                return

            create_user(**data)
            messagebox.showinfo("–£—Å–ø–µ—Ö", "–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.")
            self.show_login_page()

        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {e}")

    def logout(self):
        self.current_user = None
        self.show_login_page()

    def run(self):
        self.root.mainloop()


def main():
    init_db()
    app = EducationalPlatform()
    app.run()


if __name__ == "__main__":
    main()
